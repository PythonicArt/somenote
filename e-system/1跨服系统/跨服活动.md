# 跨服活动的基本需求
一个跨服组有N个服务器, 这n个服务器连接到一个中心服
根据一定的规则， 各服务器的世界等级或是开服天数， 划分房间， 相同发展规模的服务器在同一房间内
同一房间内的服务器玩家共享 跨服资源， 比如进入同一个场景， 消耗同一个生产资料等

# 基本实现
1. 申请一个进程， 专门负责跨服活动房间的分配， 并将分配信息存储于公共结构中， 方便获取
2. 需要维护以下信息
    1. 所有服务器的信息， 比如 开服天数， 世界等级， 节点名称等
    2. 每一个活动有自己的房间分配信息， 进行服务器的分组
    3. 有了房间的概念, 活动就被划分成多个子活动, 即每一个房间有自己专属的活动, 它们也许是同时发生的, 但是活动数据不同

3. 区分跨服和本服
    当没有进入跨服阶段时, 每个服的活动都是独立的。 可以在本服处理数据， 也可以当成每个服一个房间, 房间号可以取服务器编号, 按跨服处理。
    后者会有更大的消耗, 但是逻辑上统一, 更倾向于使用后者, 而且不需要判断是否是 本服还是跨服的状态， 减少逻辑错误.

4. 计算过程
    需要游戏服在请求前将所有数据都准备好, 发送到跨服进行计算, 结果再按房间广播出去
    跨服只维护房间信息和活动公共数据, 而不维护服务器自身的数据, 比如玩家数据, 服务器数据
    1. 跨服请求
    2. 按房间进行广播

# 跨服活动可能出现的问题
1. 活动中途房间重新划分, 是否修改共享数据

# 将任意一个本服活动修改成跨服活动
通过以上分析, 需要修改活动数据的存储格式
需要把单服的活动数据, 改成按房间分配的活动数据

日常活动
限时活动
寻宝，抽奖
市场交易

# 一个例子, 限时活动的寻宝
需求
    房间信息在活动开启一刻确定, 活动期间内不允许重新分配房间
    期间根据不同房间的平均世界等级, 进行活动功能的调整

房间分配的确定
    由于中心服没有开服时间的概念, 分配房间时需要各服自己完成, 由于会定时广播, 分配信息原则上是统一的
    所以在活动开始一刻, 取当前的分配信息, 存在各服务器即可

    也可以做一个确认机制， 来保证各服的数据是相同的, 即开活动时游戏服去中心服取， 第一个取到的数据就定下来， 之后取的都拿这个数据

房间号的确定
    如果没有被分配到房间号， 就以自己服务器编号作为房间号
    由于活动可能会开多场， 每一场需要有一个唯一地key, 一个做法是根据开启时间来生成一个key
    最终的 {RoomId, Key} 作为当前房间的房间编号


    同时， 还有一个变量， 寻宝类型 type
    可以将寻宝类型放在一起做key {Type, RoomId, Key}.
